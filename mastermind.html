<html>
    <head>
        <title>Mastermind</title>
        <script type="module">
            import {selectColors, isLastTurn, hasWon} from './game.mjs';
            import {writeTurns, writeSlots, play, end} from './window.mjs';
            let [turns, slots, colors] = [10, 5, 3];
            let state = {
                turn : 1,
                history : {}
            };
            let result = selectColors(colors, slots);
            let submit = [];

            writeTurns(document, state.history, turns);
            writeSlots(document, slots, colors);

            document.getElementById('playButton').addEventListener('click', () => {
                for(let i=1; i<=slots; i++) {
                    let element = document.getElementById(i);
                    submit.push(element.options[element.selectedIndex].text);
                }
                if(isLastTurn(state.turn, turns)) {
                    document.getElementById("outcome").innerHTML = "<h1>You lost...</h1>";
                    end(document, slots, result);
                }
                play(document, state, submit, result, turns);
                if(hasWon(submit, result)) {
                    document.getElementById("outcome").innerHTML = "<h1>You won !</h1>";
                    end(document, slots, result);
                }
                submit = [];
            });
        </script>
        <style type="text/css">
            .slot {
                width: 20px;
                height: 20px;
                display: inline-block;
            }
            .turn {
                display: inline-block;
            }
        </style>
    </head>
    <body>
        <h1>Mastermind</h1>
        <div class="main">
            <div id="turns"></div>
            <div id="result"></div>
            <div id="slots"></div>
            <button id="playButton">Jouer</button>
        </div>
        <div id="outcome"><b>Result : </b></div>
        <button onclick="location.reload()">Recommencer</button>
    </body>
</html>